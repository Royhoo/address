package cn.royhoo.address.sprider.process;

import cn.royhoo.address.sprider.dao.SpriderAddressDao;
import us.codecraft.webmagic.Page;
import us.codecraft.webmagic.Site;
import us.codecraft.webmagic.Spider;
import us.codecraft.webmagic.processor.PageProcessor;

import java.util.ArrayList;
import java.util.List;

/**
 * @author royhoo
 * @date 2017-09-25
 *
 * 爬取美团网美食类的地址，用作测试数据
 */
public class MeituanMeishiAddressProcessor implements PageProcessor {

    private Site site = Site.me().setRetryTimes(3).setSleepTime(3000);
    private SpriderAddressDao spriderAddressDao = new SpriderAddressDao();

    public void process(Page page) {
        /**
         * 如果是城市的第一页，那么就加入该城市所有的url
         */
        String url = page.getUrl().toString();
        if(url.endsWith("meishi/")){
            int ulSize = page.getHtml().xpath("//ul[@class='clearfix']/li").all().size();
            String pageNumStr = page.getHtml().xpath("//ul[@class='clearfix']/li[" + (ulSize - 1) + "]/a/text()").get();
            int pageNum = Integer.parseInt(pageNumStr); // 该城市小区页数
            List<String> urls = new ArrayList<String>();
            for(int i = 2; i <= pageNum; i++){
                urls.add(url+"pn"+i+"/");
            }
            page.addTargetRequests(urls);
        }
        String city = page.getHtml().xpath("//span[@class='current-city']/text()").get();
        List<String> address = page.getHtml().xpath("//div[@class='item-site-info']/span[2]/text()").all();
        if(address.size() > 0){
            spriderAddressDao.insertMeituanAddressData(address, city);
        }
    }

    public Site getSite() {
        return site;
    }

    public static void main(String[] args) {
        Spider spider = Spider.create(new MeituanMeishiAddressProcessor());
        String pinyin[] = getCityPinyin();
        for(int i = 0; i < pinyin.length; i++){
            String url = "http://" + pinyin[i] + ".meituan.com/meishi/";
            spider.addUrl(url);
        }
        spider.thread(3).run();
    }

    public static String[] getCityPinyin(){
        return new String[]{
                "as",
                "als",
                "anfu",
                "atushishi",
                "anning",
                "ankang",
                "ay",
                "alaer",
                "anhua",
                "arongqi",
                "aj",
                "anshun",
                "al",
                "aks",
                "anxi",
                "anyue",
                "anping",
                "ab",
                "am",
                "aletaishi",
                "anzhouqu",
                "alt",
                "aq",
                "anqing",
                "bj",
                "binyang",
                "benxi",
                "bozhou",
                "beipei",
                "bt",
                "bijie",
                "betl",
                "baz",
                "bs",
                "bobaixian",
                "bh",
                "boshan",
                "bc",
                "baishan",
                "biyang",
                "by",
                "beiliu",
                "bz",
                "baoji",
                "byne",
                "beizhenshi",
                "baofeng",
                "boluoxian",
                "boxing",
                "botou",
                "beianshi",
                "hbbazhou",
                "bishan",
                "bengbu",
                "binhai",
                "binxian",
                "baise",
                "bd",
                "bazhong",
                "baoying",
                "bayanxian",
                "boai",
                "cq",
                "cd",
                "changde",
                "changningshi",
                "cy",
                "changshu",
                "chenzhou",
                "changdu",
                "cz",
                "chalingxian",
                "changli",
                "conghua",
                "cangnan",
                "cb",
                "chongzuo",
                "chengan",
                "chizhou",
                "changyuan",
                "ch",
                "chuzhou",
                "cangxixian",
                "chengjiangxian",
                "changji",
                "chengyang",
                "chs",
                "cenxi",
                "caoxian",
                "chengdexian",
                "chengwuxian",
                "chenggu",
                "cg",
                "changshou",
                "changzhi",
                "cixi",
                "cangzhou",
                "changshan",
                "chx",
                "chengde",
                "changlecl",
                "caofeidian",
                "cili",
                "ca",
                "chongmingqu",
                "chifeng",
                "cixian",
                "chaoan",
                "changqingqu",
                "changyi",
                "changle",
                "chaozhou",
                "changfengxian",
                "chiping",
                "changting",
                "cc",
                "cx",
                "chishui",
                "chaoyangqu",
                "chongzhou",
                "chenghai",
                "dy",
                "dazhou",
                "diqing",
                "dawa",
                "dongfang",
                "dangshan",
                "dx",
                "dz",
                "dali",
                "daye",
                "dalateqi",
                "dayi",
                "deyang",
                "dalixian",
                "dsq",
                "dunhua",
                "dazhu",
                "dancheng",
                "dh",
                "dongguang",
                "dxal",
                "deqing",
                "dbs",
                "dianjiang",
                "dengzhou",
                "djy",
                "df",
                "dg",
                "dq",
                "dongxing",
                "dinganxian",
                "dandong",
                "dt",
                "daanshi",
                "donghai",
                "dingzhou",
                "dongping",
                "dianbai",
                "dangyang",
                "dongyang",
                "danzhou",
                "dengta",
                "dongtai",
                "dunhuang",
                "donggang",
                "dengfeng",
                "dl",
                "dingbianxian",
                "daoxian",
                "danyang",
                "dingtaoqu",
                "dongmingxian",
                "datongshi",
                "eminxian",
                "ez",
                "erds",
                "ems",
                "enping",
                "es",
                "eegn",
                "fengxiangxian",
                "fuguxian",
                "fengning",
                "fcg",
                "fanxian",
                "fogang",
                "fh",
                "fukang",
                "fugou",
                "fn",
                "fuan",
                "fc",
                "fudingshi",
                "feixian",
                "fs",
                "fengcheng",
                "fz",
                "fusuixian",
                "fengxin",
                "fenyang",
                "fangcheng",
                "fuyangfy",
                "fengqiu",
                "fuyuanxian",
                "fenghua",
                "fl",
                "fanchang",
                "fanzhixian",
                "fy",
                "fuz",
                "fushunxian",
                "feixixian",
                "fenyi",
                "fusong",
                "fengyang",
                "fengtai",
                "fushun",
                "fufeng",
                "fx",
                "fuqing",
                "fengxian",
                "fch",
                "feixiang",
                "gz",
                "gujiao",
                "gaoan",
                "gongqingcheng",
                "ganyu",
                "guyuan",
                "guannan",
                "gg",
                "gongyi",
                "guanyun",
                "guoluo",
                "geermu",
                "ganzi",
                "gaoyang",
                "gaoling",
                "gaoxiong",
                "gaoyou",
                "gulangyu",
                "gn",
                "gp",
                "guangde",
                "guangyuan",
                "gy",
                "gbd",
                "gj",
                "guangze",
                "gaoping",
                "gzl",
                "gm",
                "gc",
                "ganzhou",
                "gushixian",
                "gr",
                "gh",
                "gaozhou",
                "gaizhou",
                "ga",
                "gongan",
                "gl",
                "hz",
                "haining",
                "huian",
                "hami",
                "hf",
                "huxian",
                "hm",
                "huzhou",
                "huaiyuanxian",
                "huairen",
                "huixian",
                "ha",
                "houma",
                "huizexian",
                "ht",
                "huayin",
                "hanyin",
                "hannanqu",
                "hailunshi",
                "huarong",
                "huaibei",
                "hn",
                "hexian",
                "hegang",
                "hanshan",
                "huanglingxian",
                "huangshan",
                "hejiangxian",
                "huaxian",
                "hk",
                "hld",
                "hd",
                "huachuanxian",
                "haicheng",
                "hu",
                "hrb",
                "haikou",
                "huanxian",
                "haian",
                "haiyang",
                "huazhou",
                "huanghua",
                "huadian",
                "heshan",
                "hlbe",
                "huangdao",
                "haiyan",
                "huidong",
                "huiyang",
                "hongjiang",
                "huadu",
                "hechuan",
                "huaiyang",
                "hs",
                "hepuxian",
                "hualian",
                "hejianshi",
                "huozhou",
                "heihe",
                "hengdian",
                "haidong",
                "haicang",
                "honghe",
                "huangnan",
                "hongtong",
                "hb",
                "haibei",
                "hj",
                "huangchuanxian",
                "huizhou",
                "heze",
                "hx",
                "huaining",
                "heyuan",
                "hl",
                "hg",
                "hengyangxian",
                "huating",
                "hnz",
                "hshi",
                "hc",
                "hh",
                "hanzhong",
                "hezhou",
                "honghu",
                "hunchun",
                "hancheng",
                "hekou",
                "helanxian",
                "huoqiu",
                "huinan",
                "hy",
                "hengshanxian",
                "hengdongxian",
                "jz",
                "jingxian",
                "jilong",
                "jiayuxian",
                "jiayi",
                "jm",
                "jiangshan",
                "jianshuixian",
                "jincheng",
                "jianyangjy",
                "jinhu",
                "junan",
                "jianyang",
                "jinyun",
                "jinzhoushi",
                "jinxiang",
                "jzqixian",
                "jinghexian",
                "jy",
                "jishou",
                "jingshan",
                "jingxixian",
                "jiaxiang",
                "jimo",
                "jgs",
                "jinsha",
                "js",
                "jiangdu",
                "jintan",
                "jingzhou",
                "jinzhou",
                "jzg",
                "jn",
                "jiaozuo",
                "jj",
                "jinmen",
                "jx",
                "jingjiang",
                "jiaozhou",
                "jh",
                "jiangchuanxian",
                "jianshi",
                "jianghuayaozuziz",
                "jishuixian",
                "jiayixian",
                "jianxian",
                "jiangning",
                "jintang",
                "jiangyou",
                "juanchengxian",
                "juye",
                "jyg",
                "jinchang",
                "ja",
                "jdz",
                "jiangyin",
                "jr",
                "jiaxian",
                "jianhu",
                "jingbian",
                "jl",
                "jiangjin",
                "jixi",
                "jq",
                "jingmen",
                "jianli",
                "jining",
                "jiaohe",
                "jinningxian",
                "jimei",
                "jinjiang",
                "jiyuan",
                "jd",
                "jms",
                "jiexiu",
                "jiangyong",
                "ks",
                "kuancheng",
                "kz",
                "kenli",
                "kaihua",
                "krl",
                "kunshan",
                "klmy",
                "km",
                "kt",
                "kaiyang",
                "kp",
                "kaizhouqu",
                "kashishi",
                "kaifeng",
                "kangxian",
                "kl",
                "kuche",
                "lingbao",
                "luannan",
                "lp",
                "lsj",
                "lianzhou",
                "langzhong",
                "lianjiang",
                "longyou",
                "luochuanxian",
                "lixin",
                "luxian",
                "lishuiqu",
                "luopingxian",
                "lufengxian",
                "lingqiuxian",
                "lankaoxian",
                "lixian",
                "liangshanxian",
                "liaozhong",
                "lianshui",
                "linli",
                "lianyuanshi",
                "lujiangxian",
                "luodingshi",
                "luchuanxian",
                "ledong",
                "liangping",
                "luoyuanxian",
                "lingaoxian",
                "lushixian",
                "luxi",
                "linying",
                "longhui",
                "lanshan",
                "longhuaxian",
                "luoningxian",
                "lijin",
                "linyily",
                "luancheng",
                "linqu",
                "lianjiangxian",
                "longchang",
                "lintong",
                "linzhou",
                "laoting",
                "luanxian",
                "luquan",
                "lingshui",
                "lichuan",
                "linghai",
                "lhk",
                "lantian",
                "linzhang",
                "leizhou",
                "luanchuan",
                "longyao",
                "lingchuan",
                "longquan",
                "lanling",
                "linshu",
                "lushanls",
                "lingshi",
                "linyixian",
                "liuhe",
                "luyi",
                "linjiang",
                "lingshan",
                "linxia",
                "ln",
                "lz",
                "lj",
                "liangshan",
                "linzhi",
                "lasa",
                "lps",
                "lx",
                "linhai",
                "lufeng",
                "laiyang",
                "lechang",
                "lushan",
                "lk",
                "liyang",
                "leiyang",
                "lb",
                "liuzhou",
                "lyg",
                "la",
                "lishui",
                "liaoyuan",
                "liaoyang",
                "lf",
                "linfen",
                "lvliang",
                "ly",
                "luoyang",
                "ld",
                "luzhou",
                "ls",
                "luohe",
                "lw",
                "lc",
                "linyi",
                "laizhou",
                "lincang",
                "lh",
                "laixi",
                "ll",
                "linan",
                "liling",
                "lq",
                "liuyang",
                "my",
                "mh",
                "ms",
                "mc",
                "mishan",
                "mz",
                "mingshuixian",
                "menglaxian",
                "mm",
                "ml",
                "mengyin",
                "miaoli",
                "meixian",
                "mianchi",
                "mg",
                "minquan",
                "mengjin",
                "minhouxian",
                "mengzhou",
                "muping",
                "mhk",
                "miyixian",
                "mianzhu",
                "mas",
                "mdj",
                "mengcheng",
                "mingwangxing",
                "mzl",
                "mengzishi",
                "nj",
                "nn",
                "neiqiu",
                "nantou",
                "nenjiangxian",
                "scnj",
                "nanling",
                "nangong",
                "nanbuxian",
                "nanchong",
                "nh",
                "nanzhengxian",
                "nx",
                "ningyuanxian",
                "ningguo",
                "ningyang",
                "ningjinnj",
                "nanxiong",
                "nanle",
                "ninglangyizuzizh",
                "nd",
                "nq",
                "nehe",
                "nujiang",
                "nc",
                "nanhe",
                "np",
                "nt",
                "ns",
                "ningjin",
                "nb",
                "nanpixian",
                "na",
                "ninglingxian",
                "ny",
                "neihuang",
                "pe",
                "poyang",
                "pengzhou",
                "peixian",
                "pucheng",
                "pj",
                "pingchangxian",
                "pingyu",
                "puyangxian",
                "pingyinxian",
                "pingyuan",
                "penglai",
                "pds",
                "pingdong",
                "pingnanxian",
                "pingyang",
                "panshi",
                "pt",
                "pujiang",
                "pingtan",
                "pn",
                "panzhihua",
                "penghu",
                "px",
                "pingquan",
                "pl",
                "pingluoxian",
                "pingluxian",
                "pingshan",
                "pz",
                "ph",
                "pingjiang",
                "puyang",
                "py",
                "pd",
                "pingyao",
                "pingguo",
                "pingyi",
                "panxian",
                "qa",
                "qiongzhong",
                "qqhr",
                "qz",
                "qh",
                "qingyangxian",
                "qidongxian",
                "qingyun",
                "qianshan",
                "qingyuan",
                "qixiankaifeng",
                "qinganxian",
                "quzhou",
                "qishanxian",
                "qth",
                "qinggangxian",
                "qingxian",
                "qixia",
                "qj",
                "qn",
                "qingyang",
                "quanjiao",
                "qhd",
                "qxn",
                "qingtian",
                "qinzhou",
                "qinghe",
                "qixian",
                "qdn",
                "qf",
                "qingfeng",
                "qd",
                "ql",
                "qihe",
                "qy",
                "qingzhou",
                "qidong",
                "qianjiang",
                "rongxian",
                "rudong",
                "rizhao",
                "rj",
                "rongchangqu",
                "ruchengxian",
                "ruichang",
                "renqiu",
                "rg",
                "rc",
                "rz",
                "rkz",
                "renxian",
                "rs",
                "renshou",
                "ruyang",
                "rh",
                "ruian",
                "sz",
                "sh",
                "songyuan",
                "shanghe",
                "shenzexian",
                "shuozhou",
                "suidexian",
                "sx",
                "shengsi",
                "sheqi",
                "shanggao",
                "sanx",
                "suixian",
                "santaixian",
                "suiningxian",
                "shangzhi",
                "sixian",
                "shaxian",
                "smx",
                "songzi",
                "suningxian",
                "sw",
                "shuyang",
                "shehong",
                "st",
                "sg",
                "sy",
                "suizhou",
                "suining",
                "sp",
                "sn",
                "shanghang",
                "shaodong",
                "shangshuixian",
                "shizhu",
                "sqs",
                "snj",
                "shiquan",
                "shachexian",
                "shifang",
                "shanxian",
                "shenqiu",
                "shandanxian",
                "shaoyang",
                "siyang",
                "szs",
                "shawan",
                "sihong",
                "sanhe",
                "shidao",
                "shulan",
                "sanmen",
                "sishui",
                "shouxian",
                "shexian",
                "shangchengxian",
                "sm",
                "shaowu",
                "shaoshan",
                "shz",
                "shucheng",
                "shangyu",
                "sys",
                "shimen",
                "sangzhi",
                "sd",
                "shengzhou",
                "ss",
                "suzhousz",
                "shanglinxian",
                "suihua",
                "shanshanxian",
                "sanya",
                "shenmu",
                "suizhong",
                "suichuan",
                "sr",
                "shangli",
                "sheyang",
                "shenzhoushi",
                "suichang",
                "shangcai",
                "shiyan",
                "songxian",
                "shuangfeng",
                "shouguang",
                "sjz",
                "shahe",
                "suqian",
                "su",
                "sihui",
                "sq",
                "sl",
                "tj",
                "tanghe",
                "tl",
                "tiandongxian",
                "tongling",
                "taikangxian",
                "taizhou",
                "tangyin",
                "ts",
                "tonglu",
                "tn",
                "tonghaixian",
                "tz",
                "tongxuxian",
                "tongliao",
                "th",
                "taihexian",
                "tongjiangxian",
                "tengzhou",
                "tongcheng",
                "taixing",
                "tengchong",
                "taoyuanxian",
                "tongyuxian",
                "ta",
                "tongan",
                "tm",
                "tongxinxian",
                "tg",
                "taigu",
                "taiwanlianjiang",
                "taicang",
                "taihe",
                "tx",
                "tr",
                "tengxian",
                "taishan",
                "tachengshi",
                "taoyuan",
                "tmtyq",
                "tiantai",
                "tainan",
                "tianshui",
                "taidong",
                "tc",
                "tb",
                "tlf",
                "taizhong",
                "tac",
                "taiwan",
                "taiqian",
                "tonggu",
                "tianchang",
                "ty",
                "tancheng",
                "tongliang",
                "wh",
                "wys",
                "weixian",
                "wuzhou",
                "wangkuixian",
                "wupingxian",
                "wenling",
                "wugangshi",
                "wangcangxian",
                "weihai",
                "weining",
                "wltqq",
                "wg",
                "wuming",
                "wenchang",
                "wafangdian",
                "wuweiww",
                "ws",
                "wusu",
                "wuhuxian",
                "wuyi",
                "wf",
                "wx",
                "xj",
                "wanning",
                "wuzhong",
                "wuhu",
                "weishixian",
                "weichang",
                "wulongxian",
                "wds",
                "wn",
                "wenshang",
                "wuhai",
                "weishan",
                "wanzhou",
                "wuxue",
                "wuchangshi",
                "wucheng",
                "wuzhen",
                "weihui",
                "wuzhi",
                "wd",
                "wanzai",
                "wuwei",
                "wuji",
                "wlcb",
                "wc",
                "wuyang",
                "wj",
                "wz",
                "wuan",
                "wanrong",
                "wy",
                "wenxian",
                "xa",
                "xinxiangxian",
                "xingning",
                "xiangyuan",
                "xinjinxian",
                "xiantao",
                "xitang",
                "xiajin",
                "xinmin",
                "xinyixy",
                "xinan",
                "xianyouxian",
                "xingguoxian",
                "xinye",
                "xiangyunxian",
                "xiapu",
                "xintian",
                "xiangshui",
                "xx",
                "xingan",
                "xuanwei",
                "xintai",
                "xunwuxian",
                "xunyangxian",
                "xiushantujiazumi",
                "xh",
                "xinhua",
                "xinzhouqu",
                "xiangyin",
                "xiaoyi",
                "xuancheng",
                "xs",
                "xinyu",
                "xiangshan",
                "xunxian",
                "xiaogan",
                "xichuan",
                "xingcheng",
                "xt",
                "xianju",
                "xianning",
                "xiayi",
                "xianxian",
                "xiangxiang",
                "xn",
                "xupu",
                "xuwen",
                "xuyi",
                "xm",
                "xuecheng",
                "xp",
                "xgll",
                "xiangcheng",
                "xihua",
                "xishui",
                "xinfeng",
                "xinyi",
                "xiangtan",
                "xinchang",
                "xianghe",
                "xinzhou",
                "xinmi",
                "xinzhushi",
                "bn",
                "xinle",
                "xf",
                "xinning",
                "xz",
                "xy",
                "xincai",
                "xw",
                "xlgl",
                "xiping",
                "xan",
                "xiangchengxian",
                "xianyang",
                "xinji",
                "xinbei",
                "xixiang",
                "xingyang",
                "xc",
                "xiangxi",
                "xinzheng",
                "xinzhuxian",
                "yn",
                "yiliangxian",
                "yq",
                "yutaixian",
                "yizhoushi",
                "yanling",
                "yz",
                "yanbian",
                "yushushi",
                "yongfeng",
                "yt",
                "yuanlingxian",
                "yingshanxian",
                "yk",
                "yimashi",
                "yuncheng",
                "yuxian",
                "yich",
                "yongan",
                "yangshanxian",
                "yongxin",
                "yongdengxian",
                "yicheng",
                "yongjiaxian",
                "yf",
                "yiwu",
                "yangcheng",
                "yunyang",
                "yunchengxian",
                "yili",
                "yexian",
                "yanji",
                "yixian",
                "yiyangyy",
                "yl",
                "yanan",
                "yudu",
                "yucheng",
                "yishui",
                "yinan",
                "yx",
                "yuchengxian",
                "yinchuan",
                "ys",
                "yanggu",
                "yuanyang",
                "yanliang",
                "yangzhong",
                "yingcheng",
                "yidu",
                "yuanjiang",
                "yh",
                "yongji",
                "yizheng",
                "yd",
                "yichuan",
                "yongnian",
                "yunlin",
                "yuyao",
                "yangshuo",
                "yueqing",
                "yongchuan",
                "yongkang",
                "yanzhou",
                "yixing",
                "yilan",
                "yulin",
                "yushan",
                "youyangtujiazumi",
                "yichun",
                "yangling",
                "yongzhou",
                "yongcheng",
                "yiyang",
                "yjhlq",
                "yj",
                "yingtan",
                "yongxingxian",
                "yy",
                "yuminxian",
                "yingxian",
                "ya",
                "yifeng",
                "yanshi",
                "yuzhou",
                "yp",
                "youxian",
                "yc",
                "yongshunxian",
                "yb",
                "yancheng",
                "zhangzhou",
                "zunhua",
                "zixingshi",
                "zx",
                "zhengding",
                "zb",
                "zz",
                "zhangpu",
                "zj",
                "zhijiang",
                "zhalantunshi",
                "zhoushan",
                "zhucheng",
                "zhuanghe",
                "zhangshu",
                "zhongjiangxian",
                "zp",
                "zaoyang",
                "zaozhuang",
                "zhanghua",
                "zherong",
                "zhongxian",
                "zhangping",
                "zhaoyuan",
                "zjj",
                "zhungeerqi",
                "zhangye",
                "zhuzhou",
                "zhecheng",
                "zs",
                "zhaoxian",
                "zy",
                "zunyi",
                "zoucheng",
                "zt",
                "zjk",
                "zq",
                "zhijin",
                "zg",
                "zc",
                "zk",
                "zmd",
                "zhuji",
                "zhongmou",
                "zhouzhuang",
                "zjg",
                "zw",
                "zhijiangtongzu",
                "zh",
                "zhanjiang",
                "zhouzhi",
                "zhuozhou",
                "zhangqiu",
        };
    }
}
